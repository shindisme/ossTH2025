name: Deploy to FPT Hosting

on:
  push:
    branches:
      - main  # Thay "main" bằng nhánh bạn muốn tự động triển khai khi có thay đổi

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up FTP credentials
        env:
          FTP_HOST: ${{ secrets.FTP_HOST }}
          FTP_USERNAME: ${{ secrets.FTP_USERNAME }}
          FTP_PASSWORD: ${{ secrets.FTP_PASSWORD }}
        run: |
          echo "FTP_HOST=$FTP_HOST" >> $GITHUB_ENV
          echo "FTP_USERNAME=$FTP_USERNAME" >> $GITHUB_ENV
          echo "FTP_PASSWORD=$FTP_PASSWORD" >> $GITHUB_ENV

      - name: Upload files to FTP server using curl
        run: |
          # Thay đổi đường dẫn local-dir và remote-dir theo yêu cầu
          LOCAL_DIR="./"  # Thư mục chứa mã nguồn
          REMOTE_DIR="/public_html"  # Thư mục trên server FTP

          # Duyệt qua tất cả các tệp trong LOCAL_DIR và tải lên từng tệp
          find $LOCAL_DIR -type f | while read FILE; do
            echo "Uploading $FILE to FTP server..."
            curl -T $FILE --ftp-create-dirs -u ${{ env.FTP_USERNAME }}:${{ env.FTP_PASSWORD }} ftp://${{ env.FTP_HOST }}${REMOTE_DIR}/$(basename $FILE)
          done
